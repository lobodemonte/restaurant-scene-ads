---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
# Load libraries.
library("lattice")
library("ggplot2")
library("caret")
library("tidyverse")
library("ggbiplot")

# Set seed.
set.seed(321)
```

```{r}
# Load source files.
source("pcaCharts.R")

# Load data set.
data(iris)
head(iris)
```

```{r}
# Skewness and range of the variables may influence the resulting PCs; it is good practice to apply 
# some form of transformation, center and scale the variables prior to the application of PCA.
log.ir <- log(iris[, 1:4])
ir.species <- iris[, 5]
ir.pca <- prcomp(log.ir,
                 center = TRUE,
                 scale. = TRUE) 
```


```{r}
# The print method returns the standard deviation of each of the four PCs, and their 
# rotation, which are the coefficients of the linear combinations of the continuous variables.
print(ir.pca)
pcaCharts(ir.pca)
```
```{r}
# We will use the mtcars dataset, which is built into R. This dataset consists of data on 32 models of car, taken 
# from an American motoring magazine (1974 Motor Trend magazine). For each car, we have 11 features, expressed 
# in varying units (US units).
data(mtcars)
head(mtcars)
```

```{r}
# PCA works best with numerical data, therefore we'll exclude the two categorical variables (vs, am). 
# We are left with a 32x9 matrix, which we'll pass to the prcomp() function, assigning our output to mtcars.pca.
mtcars.pca <- prcomp(mtcars[,c(1:7,10,11)], 
                     center = TRUE,
                     scale. = TRUE)
summary(mtcars.pca)
```

```{r}
str(mtcars.pca)
```

```{r}
ggbiplot(mtcars.pca)
```

```{r}
# We can provide an argument to ggbiplot and name each point with the name of the car in question.
ggbiplot(mtcars.pca, 
         labels = rownames(mtcars))
```

```{r}
mtcars.country <- c(rep("Japan", 3), rep("US",4), rep("Europe", 7),rep("US",3), "Europe", rep("Japan", 3), rep("US",4), rep("Europe", 3), "US", rep("Europe", 3))

ggbiplot(mtcars.pca, 
         ellipse = TRUE,
         labels = rownames(mtcars), 
         groups = mtcars.country) + 

scale_colour_manual(name = "Origin", 
                    values = c('#E69F00','#4682b4','#6e8b3d','#ee7600','#8b1a1a','#cd1076','#8b8970','#473c8b')) +
ggtitle("PCA of mtcars dataset") +
theme_minimal() +
theme(legend.position = "bottom")
```

```{r, width = 8, height = 8}
ggbiplot(mtcars.pca, 
         ellipse = TRUE, 
         choices = c(3,4), 
         labels = rownames(mtcars), 
         groups = mtcars.country) +

scale_colour_manual(name = "Origin", 
                    values = c('#E69F00','#4682b4','#6e8b3d','#ee7600','#8b1a1a','#cd1076','#8b8970','#473c8b')) +
ggtitle("PCA of mtcars dataset") +
theme_minimal() +
theme(legend.position = "bottom")
```

```{r}
# Finally we can scale the samples (obs.scale) and the variables (var.scale).
ggbiplot(mtcars.pca,
         ellipse = TRUE,
         obs.scale = 1, # scale factor to apply to observations
         var.scale = 1, # scale factor to apply to variables
         labels = rownames(mtcars), 
         groups = mtcars.country) +

scale_colour_manual(name = "Origin", 
                    values = c('#E69F00','#4682b4','#6e8b3d','#ee7600','#8b1a1a','#cd1076','#8b8970','#473c8b')) +
ggtitle("PCA of mtcars dataset") +
theme_minimal() +
theme(legend.position = "bottom")
```

